{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///../node_modules/fast-text-encoding/text.min.js","webpack:///../node_modules/ws/browser.js","webpack:///../src/client.js","webpack:///../src/clientEvent.js","webpack:///../src/config.js","webpack:///../src/index.js","webpack:///../src/logger.js","webpack:///../src/loggerNode.js","webpack:///../src/messageEvent.js","webpack:///../src/packet.js","webpack:///../src/stt.js","webpack:///../src/util.js","webpack:///../src/websocket.js","webpack:///./index.js","webpack:///(webpack)/buildin/global.js"],"names":["config","require","event","stt","util","packet","messageEvent","Client","constructor","roomId","opts","ws","logger","heartbeatTask","ignore","options","setOptions","clientEvent","connect","name","listener","open","disconnect","close","error","initSocket","URL","on","bind","message","send","Encode","serialize","login","type","roomid","joinGroup","rid","gid","heartbeat","setInterval","HEARBEAT_INTERVAL","logout","clearInterval","run","websocket","Logger","setIgnore","key","value","isObject","i","push","defOpts","debug","logfile","hasOwnProperty","isBoolean","isString","Object","assign","messageHandle","data","Decode","m","r","deserialize","init","isBrowser","echo","keys","filter","v","includes","method","callback","clientEventName","find","toLocaleLowerCase","cb","res","messageEventName","module","exports","err","console","MessageEvent","reader","FileReader","onload","e","target","result","readAsArrayBuffer","port","random","MSG_LIVE_ON","MSG_LIVE_OFF","MSG_ROOM_RSS","MSG_BC_BUY_DESERVE","MSG_SSD","MSG_ROOM_SPBC","danmaku","Websocket","inited","db","version","IndexedDB","window","indexedDB","mozIndexedDB","webkitIndexedDB","msIndexedDB","DB","addEventListener","log","store","createObjectStore","keyPath","autoIncrement","createIndex","unique","tx","transaction","objectStore","add","room_id","timestamp","Date","getTime","frame","all","req","index","getAll","Promise","resolve","reject","count","export","text","reduce","arr","row","JSON","stringify","download","join","clear","openCursor","IDBKeyRange","only","cursor","delete","continue","fs","content","appendFile","readFile","str","split","length","readFileSync","writeFileSync","loginres","chatmsg","level","nn","txt","uenter","upgrade","rss","ss","bc_buy_deserve","ssd","spbc","sn","gn","gc","dgb","onlinegift","sil","ggbb","rankup","ranklist","mrkl","erquizisn","blab","rri","synexp","noble_num_info","gbroadcast","qausrespond","wiru","wirt","mcspeacsite","rank_change","srres","anbc","frank","Packet","HEADER_LEN_SIZE","HEADER_LEN_TYPECODE","HEADER_LEN_ENCRYPT","HEADER_LEN_PLACEHOLDER","HEADER_LEN_TOTAL","encoder","TextEncoder","decoder","TextDecoder","buffer","ArrayBuffer","readLength","concat","n","arguments","buf","Uint8Array","t","set","msgBody","encode","of","msgLen","msgTotalLen","DataView","setUint32","setInt16","byteLength","getUint32","slice","decode","Blob2ab","blob","Ab2blob","ab","Blob","STT","escape","isUndefined","toString","replace","unescape","raw","map","k","Array","isArray","isNumber","item","o","s","Util","forEach","p","prototype","call","min","max","Math","floor","filename","element","document","createElement","style","display","href","createObjectURL","body","appendChild","click","revokeObjectURL","removeChild","address","socket","WebSocket","code","reason","eventName","removeEventListener","douyudanmaku"],"mappings":"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B,GAAR,2BAAqBlD,CAAC,CAACqG,KAAvB,cAAgCrG,CAAC,CAACsG,EAAlC,0CAjBiB;AAkBpB,GA3DY;AA4DbG,SAAO,EAAE,mBAAa,CAClB;AACH,GA9DY;AA+DbC,KAAG,EAAE,aAAU1G,CAAV,EAAa;AACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAoB,WAAO,CAAC8B,GAAR,CAAY,QAAZ,EAAsBlD,CAAC,CAAC2G,EAAF,IAAQ,CAAR,GAAY5K,MAAM,CAACgG,WAAnB,GAAiChG,MAAM,CAACiG,YAA9D,CAZc;AAajB,GA5EY;AA6Eb4E,gBAAc,EAAE,0BAAa,CACzB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACH,GAzFY;AA0FbC,KAAG,EAAE,eAAa,CACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACH,GApGY;AAqGbC,MAAI,EAAE,cAAU9G,CAAV,EAAa;AACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAoB,WAAO,CAAC8B,GAAR,sCAAgClD,CAAC,CAAC+G,EAAlC,kCAA6C/G,CAAC,CAACgH,EAA/C,cAAqDhH,CAAC,CAACiH,EAAvD,EAjBe;AAkBlB,GAvHY;AAwHbC,KAAG,EAAE,eAAa,CACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACH,GAhJY;AAiJbC,YAAU,EAAE,oBAAUnH,CAAV,EAAa;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAoB,WAAO,CAAC8B,GAAR,0BAA8BlD,CAAC,CAACsG,EAAhC,wCAA4CtG,CAAC,CAACoH,GAA9C,EAZqB;AAaxB,GA9JY;AA+JbC,MAAI,EAAE,gBAAa,CACf;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACH,GA5KY;AA6KbC,QAAM,EAAE,kBAAa,CACjB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACH,GA5LY;AA6LbC,UAAQ,EAAE,oBAAa,CACnB;AACH,GA/LY;AAgMbC,MAAI,EAAE,gBAAY,CACd;AACH,GAlMY;AAmMbC,WAAS,EAAE,qBAAY,CACnB;AACH,GArMY;AAsMbC,MAAI,EAAE,gBAAY,CACd;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACH,GAjNY;AAkNbC,KAAG,EAAE,eAAY,CACb;AACH,GApNY;AAqNbC,QAAM,EAAE,kBAAY,CAEnB,CAvNY;AAwNbC,gBAAc,EAAE,0BAAY,CACxB;AACH,GA1NY;AA2NbC,YAAU,EAAE,sBAAY,CACpB;AACH,GA7NY;AA8NbC,aAAW,EAAE,uBAAY,CACrB;AACH,GAhOY;AAiObC,MAAI,EAAE,gBAAY,CACd;AACH,GAnOY;AAoObC,MAAI,EAAE,gBAAY,CACd;AACH,GAtOY;AAuObC,aAAW,EAAE,uBAAY,CACrB;AACH,GAzOY;AA0ObC,aAAW,EAAE,uBAAY,CACrB;AACH,GA5OY;AA6ObC,OAAK,EAAE,iBAAY,CACf;AACH,GA/OY;AAgPbC,MAAI,EAAE,gBAAY,CACd;AACH,GAlPY;AAmPbC,OAAK,EAAE,iBAAY,CACf;AACH;AArPY,C;;;;;;;;;;;ACFjBtM,mBAAO,CAAC,0EAAD,C;;AACP,IAAMG,IAAI,GAAGH,mBAAO,CAAC,8BAAD,CAApB;;AAEA,MAAMuM,MAAN,CAAa;AACThM,aAAW,GAAG;AACV,SAAKiM,eAAL,GAAuB,CADb,EAEV,KAAKC,mBAAL,GAA2B,CAFjB,EAGV,KAAKC,kBAAL,GAA0B,CAHhB,EAIV,KAAKC,sBAAL,GAA8B,CAJpB,EAKV,KAAKC,gBAAL,GAAwB,KAAKJ,eAAL,GAAuB,CAAvB,GACpB,KAAKC,mBADe,GAEpB,KAAKC,kBAFe,GAGpB,KAAKC,sBARC,EAUV,KAAKE,OAAL,GAAe,IAAIC,WAAJ,EAVL,EAWV,KAAKC,OAAL,GAAe,IAAIC,WAAJ,EAXL,EAYV,KAAKC,MAAL,GAAc,IAAIC,WAAJ,CAAgB,CAAhB,CAZJ,EAaV,KAAKC,UAAL,GAAkB,CAbR;AAcb;;AAEDC,QAAM,GAAG;AACL,QAAMvE,CAAG,GAAG,EAAZ;;AACA,SAAK,IAAIwE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGC,SAAS,CAACtD,MAA9B,EAAsCqD,CAAC,EAAvC,EAA2CxE,CAAG,CAACwE,CAAD,CAAH,GAASC,SAAS,CAACD,CAAD,CAA7D;;AAEA,WAAOxE,CAAG,CAACD,MAAJ,CAAW,UAAUC,CAAV,EAAe0E,CAAf,EAAoB;AAClC,UAAM3L,CAAO,GAAG2L,CAAG,YAAYL,WAAf,GAA6B,IAAIM,UAAJ,CAAeD,CAAf,CAA7B,GAAmDA,CAAnE;AACA,UAAME,CAAC,GAAG,IAAID,UAAJ,CAAe3E,CAAG,CAACmB,MAAJ,GAAapI,CAAO,CAACoI,MAApC,CAAV;AAGA,aAFAyD,CAAC,CAACC,GAAF,CAAM7E,CAAN,EAAW,CAAX,CAEA,EADA4E,CAAC,CAACC,GAAF,CAAM9L,CAAN,EAAeiH,CAAG,CAACmB,MAAnB,CACA,EAAOyD,CAAP;AACH,KANM,EAMJ,IAAID,UAAJ,CAAe,CAAf,CANI,CAAP;AAOH;;AAED1L,QAAM,CAAC+B,CAAD,EAAO;AACT,QAAM8J,CAAO,GAAG,KAAKP,MAAL,CAAY,KAAKP,OAAL,CAAae,MAAb,CAAoB/J,CAApB,CAAZ,EAAuC2J,UAAU,CAACK,EAAX,CAAc,CAAd,CAAvC,CAAhB;AACA,QAAMC,CAAM,GAAGH,CAAO,CAAC3D,MAAR,GAAiB,KAAKwC,eAAL,GAAuB,CAAvD;AACA,QAAMuB,CAAW,GAAGJ,CAAO,CAAC3D,MAAR,GAAiB,KAAK4C,gBAA1C;AACA,QAAM5I,CAAC,GAAG,IAAIgK,QAAJ,CAAa,IAAId,WAAJ,CAAgBa,CAAhB,CAAb,CAAV;AAOA,WALA/J,CAAC,CAACiK,SAAF,CAAY,CAAZ,EAAeH,CAAf,EAAuB,IAAvB,CAKA,EAJA9J,CAAC,CAACiK,SAAF,CAAY,CAAZ,EAAeH,CAAf,EAAuB,IAAvB,CAIA,EAHA9J,CAAC,CAACkK,QAAF,CAAW,CAAX,EAAc,GAAd,EAAmB,IAAnB,CAGA,EAFAlK,CAAC,CAACkK,QAAF,CAAW,EAAX,EAAe,CAAf,EAAkB,IAAlB,CAEA,GAAO,IAAIV,UAAJ,CAAexJ,CAAC,CAACiJ,MAAjB,EAAyBS,GAAzB,CAA6BC,CAA7B,EAAsC,KAAKf,gBAA3C,GAA8D5I,CAAC,CAACiJ,MAAvE;AACH;;AAEDnJ,QAAM,CAACyJ,CAAD,EAAM7I,CAAN,EAAgB;AAAA,SAClB,KAAKuI,MAAL,GAAc,KAAKG,MAAL,CAAY,KAAKH,MAAjB,EAAyBM,CAAzB,EAA8BN,MAD1B,EAEX,KAAKA,MAAL,IAAe,KAAKA,MAAL,CAAYkB,UAAZ,GAAyB,CAF7B,GAEgC;AAC9C,UAAI,MAAM,KAAKhB,UAAf,EAA2B;AACvB,YAAI,KAAKF,MAAL,CAAYkB,UAAZ,GAAyB,CAA7B,EAAgC;AAEhC,aAAKhB,UAAL,GAAkB,IAAIa,QAAJ,CAAa,KAAKf,MAAlB,EAA0BmB,SAA1B,CAAoC,CAApC,EAAuC,IAAvC,CAHK,EAIvB,KAAKnB,MAAL,GAAc,KAAKA,MAAL,CAAYoB,KAAZ,CAAkB,CAAlB,CAJS;AAK1B;;AAED,UAAI,KAAKpB,MAAL,CAAYkB,UAAZ,GAAyB,KAAKhB,UAAlC,EAA8C;AAE9C,UAAMvL,CAAO,GAAG,KAAKmL,OAAL,CAAauB,MAAb,CAAoB,KAAKrB,MAAL,CAAYoB,KAAZ,CAAkB,CAAlB,EAAqB,KAAKlB,UAAL,GAAkB,CAAvC,CAApB,CAAhB;AACA,WAAKF,MAAL,GAAc,KAAKA,MAAL,CAAYoB,KAAZ,CAAkB,KAAKlB,UAAvB,CAXgC,EAY9C,KAAKA,UAAL,GAAkB,CAZ4B,EAa9CzI,CAAQ,CAAC9C,CAAD,CAbsC;AAcjD;AACJ;AAED;;;;;;AAIA2M,SAAO,CAACC,CAAD,EAAO;AACV,WAAO,IAAIlG,OAAJ,CAAaC,CAAD,IAAqB;AACpC,UAAMjD,CAAM,GAAG,IAAIC,UAAJ,EAAf;AACAD,OAAM,CAACE,MAAP,GAAgB,UAAUC,CAAV,EAAa;AACzB8C,SAAO,CAAC9C,CAAC,CAACC,MAAF,CAASC,MAAV,CADkB;AAE5B,OAJmC,EAKpCL,CAAM,CAACM,iBAAP,CAAyB4I,CAAzB,CALoC;AAMvC,KANM,CAAP;AAOH;AAED;;;;;;AAIAC,SAAO,CAACC,CAAD,EAAK;AACR,WAAO,IAAIC,IAAJ,CAAS,CAACD,CAAD,CAAT,CAAP;AACH;;AAnFQ;;AAsFbzJ,MAAM,CAACC,OAAP,GAAiB,IAAIqH,MAAJ,E;;;;;;;;;;;ACzFjB,IAAMpM,IAAI,GAAGH,mBAAO,CAAC,8BAAD,CAApB;;AAEA,MAAM4O,GAAN,CAAU;AACNC,QAAM,CAACtK,CAAD,EAAI;AACN,WAAOpE,IAAI,CAAC2O,WAAL,CAAiBvK,CAAjB,IAAsB,EAAtB,GAA2BA,CAAC,CAACwK,QAAF,GAAaC,OAAb,CAAqB,IAArB,EAA2B,IAA3B,EAAiCA,OAAjC,CAAyC,KAAzC,EAAgD,IAAhD,CAAlC;AACH;;AAEDC,UAAQ,CAAC1K,CAAD,EAAI;AACR,WAAOpE,IAAI,CAAC2O,WAAL,CAAiBvK,CAAjB,IAAsB,EAAtB,GAA2BA,CAAC,CAACwK,QAAF,GAAaC,OAAb,CAAqB,KAArB,EAA4B,GAA5B,EAAiCA,OAAjC,CAAyC,KAAzC,EAAgD,GAAhD,CAAlC;AACH;;AAEDjN,WAAS,CAACmN,CAAD,EAAM;AACX,QAAI/O,IAAI,CAAC8C,QAAL,CAAciM,CAAd,CAAJ,EACI,OAAOxL,MAAM,CAACW,IAAP,CAAY6K,CAAZ,EAAiBC,GAAjB,CAAqBC,CAAC,cAAOA,CAAP,eAAa,KAAKP,MAAL,CAAY,KAAK9M,SAAL,CAAemN,CAAG,CAACE,CAAD,CAAlB,CAAZ,CAAb,MAAtB,EAA2ElG,IAA3E,CAAgF,EAAhF,CAAP;AAFO,WAGAmG,KAAK,CAACC,OAAN,CAAcJ,CAAd,CAHA,GAIAA,CAAG,CAACC,GAAJ,CAAQ5K,CAAC,cAAO,KAAKsK,MAAL,CAAY,KAAK9M,SAAL,CAAewC,CAAf,CAAZ,CAAP,MAAT,EAAmD2E,IAAnD,CAAwD,EAAxD,CAJA,GAKA/I,IAAI,CAACsD,QAAL,CAAcyL,CAAd,KAAsB/O,IAAI,CAACoP,QAAL,CAAcL,CAAd,CALtB,GAMAA,CAAG,CAACH,QAAJ,EANA;AAQd;;AAED9K,aAAW,CAACiL,CAAD,EAAM;AAAA,WACTA,CAAG,CAAC1K,QAAJ,CAAa,IAAb,CADS,GAEF0K,CAAG,CAACnF,KAAJ,CAAU,IAAV,EAAgBzF,MAAhB,CAAuBmB,CAAC,IAAIA,CAAC,KAAK,EAAlC,EAAsC0J,GAAtC,CAA0CK,CAAI,IAAI,KAAKvL,WAAL,CAAiBuL,CAAjB,CAAlD,CAFE,GAKTN,CAAG,CAAC1K,QAAJ,CAAa,IAAb,CALS,GAMF0K,CAAG,CAACnF,KAAJ,CAAU,GAAV,EAAezF,MAAf,CAAsBmB,CAAC,IAAIA,CAAC,KAAK,EAAjC,EAAqCmD,MAArC,CAA4C,CAAC6G,CAAD,EAAIC,CAAJ,KAAU;AACzD,UAAM,CAACN,CAAD,EAAI7K,CAAJ,IAASmL,CAAC,CAAC3F,KAAF,CAAQ,IAAR,CAAf;AAEA,aADA0F,CAAC,CAACL,CAAD,CAAD,GAAO,KAAKnL,WAAL,CAAiB,KAAKgL,QAAL,CAAc1K,CAAd,CAAjB,CACP,EAAOkL,CAAP;AACH,KAJM,EAIJ,EAJI,CANE,GAWFP,CAAG,CAAC1K,QAAJ,CAAa,KAAb,CAXE,GAYF,KAAKP,WAAL,CAAiB,KAAKgL,QAAL,CAAcC,CAAd,CAAjB,CAZE,GAcFA,CAAG,CAACH,QAAJ,EAdE;AAgBhB;;AAnCK;;AAsCV9J,MAAM,CAACC,OAAP,GAAiB,IAAI0J,GAAJ,E;;;;;;;;;;;ACxCjB,SAASe,IAAT,GAAgB;AACZ,GACI,QADJ,EAEI,OAFJ,EAGI,QAHJ,EAII,QAJJ,EAKI,SALJ,EAMI,UANJ,EAOI,QAPJ,EAQI,MARJ,EASI,WATJ,EAUI,MAVJ,EAWI,QAXJ,EAYI,MAZJ,EAaI,aAbJ,EAcEC,OAdF,CAcU3N,CAAI,IAAI;AACd,qBAAUA,CAAV,KAAqB4N,CAAD,IAAOnM,MAAM,CAACoM,SAAP,CAAiBf,QAAjB,CAA0BgB,IAA1B,CAA+BF,CAA/B,EAAkCxB,KAAlC,CAAwC,CAAxC,EAA2C,CAAC,CAA5C,MAAmDpM,CADhE;AAEjB,GAhBD,CADY;AAkBf,C,CAED;;;AAGA;AAGA;AALA0N,IAAI,CAACG,SAAL,CAAe3L,SAAf,GAA2B,MAAO,OAAOwC,MAAP,KAAkB,W,EAGpDgJ,IAAI,CAACG,SAAL,CAAehK,MAAf,GAAwB,CAACkK,CAAD,EAAMC,CAAN,KAAcC,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACpK,MAAL,MAAiBmK,CAAG,GAAGD,CAAN,GAAY,CAA7B,IAAkCA,CAA7C,C,EAGtCL,IAAI,CAACG,SAAL,CAAe7G,QAAf,GAA0B,UAASmH,CAAT,EAAmBzH,CAAnB,EAAyB;AAC/C,MAAI,KAAKxE,SAAL,EAAJ,EAAsB;AAClB,QAAIkM,CAAO,GAAGC,QAAQ,CAACC,aAAT,CAAuB,GAAvB,CAAd;AACAF,KAAO,CAACG,KAAR,CAAcC,OAAd,GAAwB,MAFN;AAGlB,QAAIjC,CAAI,GAAG,IAAIG,IAAJ,CAAS,CAAChG,CAAD,CAAT,CAAX;AACA0H,KAAO,CAACpH,QAAR,aAAsBmH,CAAtB,SAJkB,EAKlBC,CAAO,CAACK,IAAR,GAAejP,GAAG,CAACkP,eAAJ,CAAoBnC,CAApB,CALG,EAMlB8B,QAAQ,CAACM,IAAT,CAAcC,WAAd,CAA0BR,CAA1B,CANkB,EAOlBA,CAAO,CAACS,KAAR,EAPkB,EAQlBrP,GAAG,CAACsP,eAAJ,CAAoBvC,CAApB,CARkB,EASlB8B,QAAQ,CAACM,IAAT,CAAcI,WAAd,CAA0BX,CAA1B,CATkB;AAUrB;AACJ,C,EAEDpL,MAAM,CAACC,OAAP,GAAiB,IAAIyK,IAAJ,E;;;;;;;;;;;ACzCjB,IAAMxP,IAAI,GAAGH,mBAAO,CAAC,8BAAD,CAApB;;AAEA,MAAM4C,SAAN,CAAgB;AACZrC,aAAW,CAAC0Q,CAAD,EAAU;AACjB,SAAK9P,QAAL,GAAgB,EADC,EAEjB,KAAK+P,MAAL,GAAc,IAAIC,SAAJ,CAAcF,CAAd,CAFG;AAGpB;;AAEDpP,MAAI,CAACgC,CAAD,EAAO;AACP,SAAKqN,MAAL,CAAYrP,IAAZ,CAAiBgC,CAAjB,CADO;AAEV;;AAEDvC,OAAK,CAAC8P,CAAD,EAAOC,CAAP,EAAe;AAChB,SAAKH,MAAL,CAAY5P,KAAZ,CAAkB8P,CAAlB,EAAwBC,CAAxB,CADgB;AAEnB;;AAED3P,IAAE,CAAC+C,CAAD,EAASC,CAAT,EAAmB;AACjB,QAAI4M,CAAS,GAAG,CAAC,MAAD,EAAS,OAAT,EAAkB,OAAlB,EAA2B,SAA3B,EAAsC1M,IAAtC,CAA2C3E,CAAK,IAAIA,CAAK,KAAKwE,CAAM,CAACI,iBAAP,EAA9D,CAAhB;AAEIyM,KAHa,KAIT5N,MAAM,CAACW,IAAP,CAAY,KAAKlD,QAAjB,EAA2BqD,QAA3B,CAAoC8M,CAApC,CAJS,IAKT,KAAKJ,MAAL,CAAYK,mBAAZ,CAAgCD,CAAhC,EAA2C,KAAKnQ,QAAL,CAAcmQ,CAAd,CAA3C,CALS,EAQb,KAAKnQ,QAAL,CAAcmQ,CAAd,IAA2B5M,CARd,EASb,KAAKwM,MAAL,CAAYjK,gBAAZ,CAA6BqK,CAA7B,EAAwC5M,CAAxC,CATa;AAWpB;;AAzBW;;AA4BhBO,MAAM,CAACC,OAAP,GAAiB/E,IAAI,CAACgE,SAAL,KAAmBvB,SAAnB,GAA+B5C,mBAAO,CAAC,yCAAD,C;;;;;;;;;;;;AC9BvD;AAAA;AAAA;AAAA;;AACA;AAEA2G,MAAM,CAAC6K,YAAP,GAAsBA,iD,EACtB7K,MAAM,CAACN,OAAP,GAAiBmL,iD;;;;;;;;;;;;;;;;;;;;;;ACJjB;;AAEA;AACA;AACA;AACA,CAAC;;AAED;AACA;AACA;AACA,CAAC;AACD;AACA;AACA;;AAEA;AACA;AACA,4CAA4C;;AAE5C","file":"douyudanmaku.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./index.js\");\n","(function(l){function m(){}function k(b,a){b=void 0===b?\"utf-8\":b;a=void 0===a?{fatal:!1}:a;if(-1==n.indexOf(b.toLowerCase()))throw new RangeError(\"Failed to construct 'TextDecoder': The encoding label provided ('\"+b+\"') is invalid.\");if(a.fatal)throw Error(\"Failed to construct 'TextDecoder': the 'fatal' option is unsupported.\");}if(l.TextEncoder&&l.TextDecoder)return!1;var n=[\"utf-8\",\"utf8\",\"unicode-1-1-utf-8\"];Object.defineProperty(m.prototype,\"encoding\",{value:\"utf-8\"});m.prototype.encode=function(b,\na){a=void 0===a?{stream:!1}:a;if(a.stream)throw Error(\"Failed to encode: the 'stream' option is unsupported.\");a=0;for(var g=b.length,f=0,c=Math.max(32,g+(g>>1)+7),e=new Uint8Array(c>>3<<3);a<g;){var d=b.charCodeAt(a++);if(55296<=d&&56319>=d){if(a<g){var h=b.charCodeAt(a);56320===(h&64512)&&(++a,d=((d&1023)<<10)+(h&1023)+65536)}if(55296<=d&&56319>=d)continue}f+4>e.length&&(c+=8,c*=1+a/b.length*2,c=c>>3<<3,h=new Uint8Array(c),h.set(e),e=h);if(0===(d&4294967168))e[f++]=d;else{if(0===(d&4294965248))e[f++]=\nd>>6&31|192;else if(0===(d&4294901760))e[f++]=d>>12&15|224,e[f++]=d>>6&63|128;else if(0===(d&4292870144))e[f++]=d>>18&7|240,e[f++]=d>>12&63|128,e[f++]=d>>6&63|128;else continue;e[f++]=d&63|128}}return e.slice?e.slice(0,f):e.subarray(0,f)};Object.defineProperty(k.prototype,\"encoding\",{value:\"utf-8\"});Object.defineProperty(k.prototype,\"fatal\",{value:!1});Object.defineProperty(k.prototype,\"ignoreBOM\",{value:!1});k.prototype.decode=function(b,a){a=void 0===a?{stream:!1}:a;if(a.stream)throw Error(\"Failed to decode: the 'stream' option is unsupported.\");\nb.buffer instanceof ArrayBuffer&&(b=b.buffer);b=new Uint8Array(b);a=0;for(var g=[],f=[];;){var c=a<b.length;if(!c||a&65536){f.push(String.fromCharCode.apply(null,g));if(!c)return f.join(\"\");g=[];b=b.subarray(a);a=0}c=b[a++];if(0===c)g.push(0);else if(0===(c&128))g.push(c);else if(192===(c&224)){var e=b[a++]&63;g.push((c&31)<<6|e)}else if(224===(c&240)){e=b[a++]&63;var d=b[a++]&63;g.push((c&31)<<12|e<<6|d)}else if(240===(c&248)){e=b[a++]&63;d=b[a++]&63;var h=b[a++]&63;c=(c&7)<<18|e<<12|d<<6|h;65535<\nc&&(c-=65536,g.push(c>>>10&1023|55296),c=56320|c&1023);g.push(c)}}};l.TextEncoder=m;l.TextDecoder=k})(\"undefined\"!==typeof window?window:\"undefined\"!==typeof global?global:this);\n","'use strict';\n\nmodule.exports = function() {\n  throw new Error(\n    'ws does not work in the browser. Browser clients must use the native ' +\n      'WebSocket object'\n  );\n};\n","const config = require('./config')\r\nconst event = require('./clientEvent')\r\nconst stt = require('./stt')\r\nconst util = require('./util')\r\nconst packet = require('./packet')\r\nconst messageEvent = require('./messageEvent')\r\n\r\nclass Client {\r\n    constructor(roomId, opts) {\r\n        this.roomId = roomId\r\n        this.ws = null\r\n        this.logger = null\r\n        this.heartbeatTask = null\r\n        this.messageEvent = messageEvent\r\n        this.ignore = []\r\n        this.options = this.setOptions(opts || {})\r\n        this.clientEvent = {\r\n            connect: {\r\n                name: 'open',\r\n                listener: event.open\r\n            },\r\n            disconnect: {\r\n                name: 'close',\r\n                listener: event.close\r\n            },\r\n            error: {\r\n                name: 'error',\r\n                listener: event.error\r\n            },\r\n        }\r\n    }\r\n\r\n    initSocket(ws) {\r\n        this.ws = new ws(config.URL)\r\n        this.ws.on('open', this.clientEvent.connect.listener.bind(this))\r\n        this.ws.on('error', this.clientEvent.error.listener.bind(this))\r\n        this.ws.on('close', this.clientEvent.disconnect.listener.bind(this))\r\n        this.ws.on('message', event.message.bind(this))\r\n    }\r\n\r\n    send(message) {\r\n        this.ws.send(packet.Encode(stt.serialize(message)))\r\n    }\r\n\r\n    login() {\r\n        this.send({\r\n            type: 'loginreq',\r\n            roomid: this.roomId,\r\n        })\r\n    }\r\n\r\n    joinGroup() {\r\n        this.send({\r\n            type: 'joingroup',\r\n            rid: this.roomId,\r\n            gid: -9999\r\n        })\r\n    }\r\n\r\n    heartbeat() {\r\n        this.heartbeatTask = setInterval(() => {\r\n            this.send({\r\n                type: 'mrkl'\r\n            })\r\n        }, config.HEARBEAT_INTERVAL * 1000)\r\n    }\r\n\r\n    logout() {\r\n        this.send({\r\n            type: 'logout',\r\n        })\r\n\r\n        clearInterval(this.heartbeatTask)\r\n    }\r\n\r\n    run(websocket, logger) {\r\n        const ws = websocket || require('./websocket')\r\n        const Logger = logger || require('./logger')\r\n        this.logger = new Logger()\r\n        this.initSocket(ws)\r\n    }\r\n\r\n    setIgnore(key, value) {\r\n        if (util.isObject(key)) {\r\n            for (let i in key) {\r\n                if (key[i]) {\r\n                    this.ignore.push(i)\r\n                }\r\n            }\r\n        } else {\r\n            if (value) {\r\n                this.ignore.push(key)\r\n            }\r\n        }\r\n\r\n        return this\r\n    }\r\n\r\n    setOptions(opts) {\r\n        const defOpts = {\r\n            debug: false,\r\n            logfile: `${this.roomId}.log`,\r\n        }\r\n        const options = {}\r\n\r\n        if (!util.isObject(opts)) {\r\n            return defOpts\r\n        }\r\n\r\n        if (opts.hasOwnProperty('debug') && util.isBoolean(opts.debug)) {\r\n            options.debug = opts.debug\r\n        }\r\n\r\n        if (opts.hasOwnProperty('logfile') && util.isString(opts.logfile)) {\r\n            options.logfile = opts.logfile\r\n        }\r\n\r\n        return Object.assign(defOpts, options)\r\n    }\r\n\r\n    messageHandle(data) {\r\n        packet.Decode(data, m => {\r\n            const r = stt.deserialize(m)\r\n    \r\n            if (this.options.debug) {\r\n                this.logger.init(util.isBrowser() ? this.roomId : this.options.logfile)\r\n                this.logger.echo(r)\r\n            }\r\n\r\n            if (Object.keys(this.messageEvent).filter(v => {\r\n                    return !this.ignore.includes(v)\r\n                }).includes(r.type)) {\r\n                this.messageEvent[r.type](r)\r\n            }\r\n        })\r\n    }\r\n\r\n    on(method, callback) {\r\n        const clientEventName = Object.keys(this.clientEvent).find(clientEvent => clientEvent === method.toLocaleLowerCase())\r\n        if (clientEventName) {\r\n            //在创建连接是触发connect事件时，发送登入，加入组，监听心跳消息\r\n            if (clientEventName === 'connect') {\r\n                let cb = callback\r\n                callback = function (res) {\r\n                    this.login()\r\n                    this.joinGroup()\r\n                    this.heartbeat()\r\n                    cb.bind(this)(res)\r\n                }\r\n            }\r\n            this.clientEvent[method].listener = callback.bind(this)\r\n        }\r\n\r\n        const messageEventName = Object.keys(this.messageEvent).find(messageEvent => messageEvent === method.toLocaleLowerCase())\r\n        if (messageEventName) {\r\n            this.messageEvent[method] = callback.bind(this)\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = Client\r\n","function open() {\r\n    this.login() //登入\r\n    this.joinGroup() //加入组\r\n    this.heartbeat() //发送心跳，强制45秒\r\n}\r\n\r\nfunction error(err) {\r\n    console.error(err)\r\n}\r\n\r\nfunction close() {\r\n    this.logout()\r\n}\r\n\r\nfunction message(data) {\r\n    if (typeof MessageEvent !== 'undefined') {\r\n        //无MessageEvent类型判断为node环境，转换数据为arraybuffer类型\r\n        const reader = new FileReader()\r\n        reader.onload = e => this.messageHandle(e.target.result)\r\n        reader.readAsArrayBuffer(data.data)\r\n    } else {\r\n        this.messageHandle(data)\r\n    }\r\n}\r\n\r\nmodule.exports = {\r\n    open,\r\n    error,\r\n    close,\r\n    message,\r\n}","const util = require('./util')\r\n\r\n//目前已知的弹幕服务器\r\nconst port = 8500 + util.random(1, 6)\r\nconst URL = `wss://danmuproxy.douyu.com:${port}/`\r\n\r\nconst HEARBEAT_INTERVAL = 45\r\n\r\nconst MSG_LIVE_ON = '主播正在直播'\r\nconst MSG_LIVE_OFF = '主播没有直播'\r\nconst MSG_ROOM_RSS = '房间开播提醒'\r\nconst MSG_BC_BUY_DESERVE = '赠送酬勤通知'\r\nconst MSG_SSD = '超级弹幕'\r\nconst MSG_ROOM_SPBC = '房间内礼物广播'\r\n\r\nmodule.exports = {\r\n    URL,\r\n    HEARBEAT_INTERVAL,\r\n    MSG_LIVE_ON,\r\n    MSG_LIVE_OFF,\r\n    MSG_ROOM_RSS,\r\n    MSG_BC_BUY_DESERVE,\r\n    MSG_SSD,\r\n    MSG_ROOM_SPBC,\r\n}","'use strict';\r\n\r\nconst danmaku = require('./client')\r\ndanmaku.stt = require('./stt')\r\ndanmaku.util = require('./util')\r\ndanmaku.logger = require('./logger')\r\ndanmaku.Websocket = require('./websocket')\r\ndanmaku.packet = require('./packet')\r\n\r\nmodule.exports = danmaku","const util = require('./util')\r\n\r\nclass Logger {\r\n    constructor() {\r\n        this.name = 'unknown'\r\n        this.inited = false\r\n        this.db = null\r\n        this.version = 2\r\n    }\r\n\r\n    init(name) {\r\n        if (!this.inited) {\r\n            this.name = name\r\n\r\n            const IndexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB\r\n            this.DB = IndexedDB.open('danmaku', this.version)\r\n            this.DB.addEventListener('success', e => {\r\n                console.log('连接数据库')\r\n                this.db = e.target.result\r\n            })\r\n\r\n            this.DB.addEventListener('upgradeneeded', e => {\r\n                console.log('升级数据库')\r\n                this.db = e.target.result\r\n                const store = this.db.createObjectStore('douyu', {\r\n                    keyPath: 'id',\r\n                    autoIncrement: true,\r\n                })\r\n                store.createIndex('idx_room_id', 'room_id', {\r\n                    unique: false\r\n                })\r\n            })\r\n\r\n            this.DB.addEventListener('error', e => {\r\n                console.log('连接数据库出错 Error:', e)\r\n            })\r\n\r\n            this.inited = true\r\n        }\r\n    }\r\n\r\n    echo(data) {\r\n        if (this.db !== null) {\r\n            const tx = this.db.transaction('douyu', 'readwrite')\r\n            const store = tx.objectStore('douyu')\r\n            store.add({\r\n                room_id: this.name,\r\n                timestamp: new Date().getTime(),\r\n                frame: data\r\n            })\r\n        }\r\n    }\r\n\r\n    all(roomId) {\r\n        if (this.db !== null) {\r\n            const tx = this.db.transaction('douyu', 'readonly')\r\n            const store = tx.objectStore('douyu')\r\n            const req = (roomId ? store.index('idx_room_id').getAll(roomId) : store.getAll())\r\n            return new Promise(function (resolve, reject) {\r\n                req.addEventListener('success', function (e) {\r\n                    resolve(e.target.result)\r\n                })\r\n                req.addEventListener('error', function (e) {\r\n                    reject(false)\r\n                })\r\n            })\r\n        }\r\n    }\r\n\r\n    count(roomId) {\r\n        if (this.db !== null) {\r\n            const tx = this.db.transaction('douyu', 'readonly')\r\n            const store = tx.objectStore('douyu')\r\n            const req = (roomId ? store.index('idx_room_id').count(roomId) : store.count())\r\n            return new Promise(function (resolve, reject) {\r\n                req.addEventListener('success', function (e) {\r\n                    resolve(req.result)\r\n                })\r\n                req.addEventListener('error', function (e) {\r\n                    reject(false)\r\n                })\r\n            })\r\n        }\r\n    }\r\n\r\n    async export (roomId) {\r\n        if (this.db !== null) {\r\n            const r = await this.all(roomId)\r\n            const text = r.reduce((arr, row) => {\r\n                const v = {\r\n                    timestamp: row.timestamp,\r\n                    frame: row.frame,\r\n                }\r\n                if (!roomId) v.roomId = this.name\r\n                arr.push(JSON.stringify(v))\r\n                return arr\r\n            }, [])\r\n            util.download(this.name, text.join('\\n'))\r\n            return text\r\n        }\r\n    }\r\n\r\n    clear(roomId) {\r\n        if (this.db !== null) {\r\n            const tx = this.db.transaction('douyu', 'readwrite')\r\n            const store = tx.objectStore('douyu')\r\n            if (roomId) {\r\n                const index = store.index('idx_room_id')\r\n                const req = index.openCursor(IDBKeyRange.only(roomId))\r\n                req.addEventListener('success', function () {\r\n                    const cursor = req.result\r\n                    if (cursor) {\r\n                        cursor.delete()\r\n                        cursor.continue()\r\n                    }\r\n                })\r\n            } else {\r\n                store.clear()\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = util.isBrowser() ? Logger : require('./loggerNode')","const fs = require('fs')\r\n\r\nmodule.exports = class Logger {\r\n    constructor() {\r\n        this.name = 'unknown'\r\n        this.inited = false\r\n    }\r\n\r\n    init(name) {\r\n        if (!this.inited) {\r\n            this.name = name\r\n            this.inited = true\r\n        }\r\n    }\r\n\r\n    echo(data) {\r\n        const content = `${JSON.stringify({timestamp: new Date().getTime(),frame: data})}\\n`\r\n        fs.appendFile(\r\n            this.name,\r\n            content,\r\n            function (err) {\r\n                if (err) {\r\n                    console.error('日志保存出错, Error:', err)\r\n                }\r\n            })\r\n    }\r\n\r\n    all() {\r\n        return new Promise((resolve, reject) => {\r\n            fs.readFile(this.name, 'utf8', function (err, str) {\r\n                if (err) {\r\n                    reject(err)\r\n                } else {\r\n                    resolve(str)\r\n                }\r\n            })\r\n        })\r\n    }\r\n\r\n    count() {\r\n        return new Promise(async (resolve, reject) => {\r\n            const content = await this.all()\r\n            resolve(content.split('\\n').filter(v => v !== '').length)\r\n        })\r\n    }\r\n\r\n    export () {\r\n        return fs.readFileSync(this.name, 'utf8')\r\n    }\r\n\r\n    clear() {\r\n        try {\r\n            return fs.writeFileSync(this.name, '', 'utf8')\r\n        } catch (err) {\r\n            return false\r\n        }\r\n    }\r\n}\r\n","const config = require('./config')\r\n\r\nmodule.exports = {\r\n    loginres: function (r) {\r\n        // 登录响应\r\n        // 服务端返回登录响应消息,完整的数据部分应包含的字段如下:\r\n        // 字段说明\r\n        //     type             表示为“登录”消息,固定为 loginres\r\n        //     userid           用户 ID\r\n        //     roomgroup        房间权限组\r\n        //     pg               平台权限组\r\n        //     sessionid        会话 ID\r\n        //     username         用户名\r\n        //     nickname         用户昵称\r\n        //     is_signed        是否已在房间签到\r\n        //     signed_count     日总签到次数\r\n        //     live_stat        直播状态\r\n        //     npv              是否需要手机验证\r\n        //     best_dlev        最高酬勤等级\r\n        //     cur_lev          酬勤等级\r\n    },\r\n    chatmsg: function (r) {\r\n        // 弹幕消息\r\n        // 用户在房间发送弹幕时,服务端发此消息给客户端,完整的数据部分应包含的字 段如下:\r\n        // 字段说明\r\n        //     type             表示为“弹幕”消息,固定为 chatmsg\r\n        //     gid              弹幕组 id\r\n        //     rid              房间 id\r\n        //     uid              发送者 uid\r\n        //     nn               发送者昵称\r\n        //     txt              弹幕文本内容\r\n        //     cid              弹幕唯一 ID\r\n        //     level            用户等级\r\n        //     gt               礼物头衔:默认值 0(表示没有头衔)\r\n        //     col              颜色:默认值 0(表示默认颜色弹幕)\r\n        //     ct               客户端类型:默认值 0(表示 web 用户)\r\n        //     rg               房间权限组:默认值 1(表示普通权限用户)\r\n        //     pg               平台权限组:默认值 1(表示普通权限用户)\r\n        //     dlv              酬勤等级:默认值 0(表示没有酬勤)\r\n        //     dc               酬勤数量:默认值 0(表示没有酬勤数量)\r\n        //     bdlv             最高酬勤等级:默认值 0(表示全站都没有酬勤)\r\n        console.log(\"<lv %s> [%s]  %s\", r.level + (r.level < 10 ? ' ' : ''), r.nn, r.txt)\r\n    },\r\n    uenter: function (r) {\r\n        // 进入直播间\r\n        // 具有特殊属性的用户进入直播间时,服务端发送此消息至客户端。完整的数据部 分应包含的字段如下:\r\n        // 字段说明\r\n        //     type   表示为“用户进房通知”消息,固定为 uenter\r\n        //     rid    房间 ID\r\n        //     gid    弹幕分组 ID\r\n        //     uid    用户 ID\r\n        //     nn     用户昵称\r\n        //     str    战斗力\r\n        //     level  新用户等级\r\n        //     gt     礼物头衔:默认值 0(表示没有头衔)\r\n        //     rg     房间权限组:默认值 1(表示普通权限用户)\r\n        //     pg     平台身份组:默认值 1(表示普通权限用户)\r\n        //     dlv    酬勤等级:默认值 0(表示没有酬勤)\r\n        //     dc     酬勤数量:默认值 0(表示没有酬勤数量)\r\n        //     bdlv   最高酬勤等级:默认值 0(表示全站都没有酬勤)\r\n        console.log(`欢迎<lv ${r.level}>${r.nn}进入了直播间`)\r\n    },\r\n    upgrade: function (r) {\r\n        // 用户等级提升\r\n    },\r\n    rss: function (r) {\r\n        // 房间开播提醒\r\n        // 房间开播提醒主要部分应包含的字段如下:\r\n        // 字段说明\r\n        //     type    表示为“房间开播提醒”消息,固定为 rss\r\n        //     rid     房间 id\r\n        //     gid     弹幕分组 id\r\n        //     ss      直播状态,1-正在直播, 2-没有直播\r\n        //     code    类型\r\n        //     rt      开关播原因:0-主播开关播,其他值-其他原因\r\n        //     notify  通知类型\r\n        //     endtime 关播时间(仅关播时有效)\r\n        console.log('[开播提醒]', r.ss == 1 ? config.MSG_LIVE_ON : config.MSG_LIVE_OFF)\r\n    },\r\n    bc_buy_deserve: function (r) {\r\n        // 赠送酬勤通知\r\n        // 用户赠送酬勤时,服务端发送此消息至客户端。完整的数据部分应包含的字段如 下:\r\n        // 字段说明\r\n        //     type   表示为“赠送酬勤通知”消息,固定为 bc_buy_deserve\r\n        //     rid    房间 ID\r\n        //     gid    弹幕分组 ID\r\n        //     level  用户等级\r\n        //     cnt    赠送数量\r\n        //     hits   赠送连击次数\r\n        //     lev    酬勤等级\r\n        //     sui    用户信息序列化字符串,详见下文。注意,此处为嵌套序列化,需注 意符号的转义变换。(转义符号参见 2.2 序列化)\r\n    },\r\n    ssd: function (r) {\r\n        // 超级弹幕\r\n        // 超级弹幕主要部分应包含的字段如下:\r\n        // 字段说明\r\n        //     type     表示为“超级弹幕”消息,固定为 ssd\r\n        //     rid      房间 id\r\n        //     gid      弹幕分组 id\r\n        //     sdid     超级弹幕 id\r\n        //     trid     跳转房间 id\r\n        //     content  超级弹幕的内容\r\n    },\r\n    spbc: function (r) {\r\n        // 房间内礼物广播\r\n        // 房间内赠送礼物成功后效果主要部分应包含的字段如下:\r\n        //  字段说明\r\n        //     type   表示为“房间内礼物广播”,固定为 spbc\r\n        //     rid    房间 id\r\n        //     gid    弹幕分组 id\r\n        //     sn     赠送者昵称\r\n        //     dn     受赠者昵称\r\n        //     gn     礼物名称\r\n        //     gc     礼物数量\r\n        //     drid   赠送房间\r\n        //     gs     广播样式\r\n        //     gb     是否有礼包(0-无礼包,1-有礼包)\r\n        //     es     广播展现样式(1-火箭,2-飞机)\r\n        //     gfid   礼物 id\r\n        //     eid    特效 id\r\n        console.log(`------------- 感谢[${r.sn}] 赠送的 ${r.gn}x${r.gc}`)\r\n    },\r\n    dgb: function (r) {\r\n        // 赠送礼物\r\n        // 用户在房间赠送礼物时,服务端发送此消息给客户端。完整的数据部分应包含的 字段如下:\r\n        // 字段说明\r\n        //     type   表示为“赠送礼物”消息,固定为 dgb\r\n        //     rid    房间 ID\r\n        //     gid    弹幕分组 ID\r\n        //     gfid   礼物 id\r\n        //     gs     礼物显示样式\r\n        //     uid    用户 id\r\n        //     nn     用户昵称\r\n        //     str    用户战斗力\r\n        //     level  用户等级\r\n        //     dw     主播体重\r\n        //     gfcnt  礼物个数:默认值 1(表示 1 个礼物)\r\n        //     hits   礼物连击次数:默认值 1(表示 1 连击)\r\n        //     dlv    酬勤头衔:默认值 0(表示没有酬勤)\r\n        //     dc     酬勤个数:默认值 0(表示没有酬勤数量)\r\n        //     bdl    全站最高酬勤等级:默认值 0(表示全站都没有酬勤)\r\n        //     rg     房间身份组:默认值 1(表示普通权限用户)\r\n        //     pg     平台身份组:默认值 1(表示普通权限用户)\r\n        //     rpid   红包 id:默认值 0(表示没有红包)\r\n        //     slt    红包开启剩余时间:默认值 0(表示没有红包)\r\n        //     elt    红包销毁剩余时间:默认值 0(表示没有红包)\r\n    },\r\n    onlinegift: function (r) {\r\n        // 领取在线鱼丸\r\n        // 在线领取鱼丸时,若出现暴击(鱼丸数大于等于 60)服务则发送领取暴击消息 到客户端。完整的数据部分应包含的字段如下:\r\n        // 字段说明\r\n        //     type             表示为“领取在线鱼丸”消息,固定为 onlinegift\r\n        //     rid              房间 ID\r\n        //     uid              用户 ID\r\n        //     gid              弹幕分组 ID\r\n        //     sil              鱼丸数\r\n        //     if               领取鱼丸的等级\r\n        //     ct               客户端类型标识\r\n        //     nn               用户昵称\r\n        console.log(`------------- [${r.nn}] 领取鱼丸x${r.sil}`)\r\n    },\r\n    ggbb: function (r) {\r\n        // 房间用户抢红包\r\n        // 房间赠送礼物成功后效果(赠送礼物效果,连击数)主要部分应包含的字段如下:\r\n        // 字段说明\r\n        //     type  表示“房间用户抢红包”信息,固定为 ggbb\r\n        //     rid   房间 id\r\n        //     gid   弹幕分组 id\r\n        //     sl    抢到的鱼丸数量\r\n        //     sid   礼包产生者 id\r\n        //     did   抢礼包者 id\r\n        //     snk   礼包产生者昵称\r\n        //     dnk   抢礼包者昵称\r\n        //     rpt   礼包类型\r\n    },\r\n    rankup: function (r) {\r\n        // 房间内top10变化消息\r\n        // 房间内 top10 排行榜变化后,广播。主要部分应包含的字段如下:\r\n        // 字段说明\r\n        // type  表示为“房间 top10 排行榜变换”,固定为 rankup\r\n        // rid   房间 id\r\n        // gid   弹幕分组 id\r\n        // uid   用户 id\r\n        // drid  目标房间 id\r\n        // rt    房间所属栏目类型\r\n        // bt    广播类型:1-房间内广播,2-栏目广播,4-全站广播\r\n        // sz    展示区域:1-聊天区展示,2-flash 展示,3-都显示\r\n        // nk    用户昵称\r\n        // rkt   top10 榜的类型 1-周榜 2-总榜 4-日榜\r\n        // rn    上升后的排名\r\n    },\r\n    ranklist: function (r) {\r\n        // 广播排行榜消息\r\n    },\r\n    mrkl: function(r) {\r\n        // 心跳\r\n    },\r\n    erquizisn: function(r) {\r\n        // 鱼丸预言，参数未知\r\n    },\r\n    blab: function(r) {\r\n        // 粉丝等级升级\r\n        // 字段说明\r\n        // type  表示为“粉丝等级升级”,固定为 blab\r\n        // rid   房间 id\r\n        // uid   用户 id\r\n        // nn  用户昵称\r\n        // bl  升级后的等级\r\n        // bnn 升级的粉丝牌\r\n        // lbl 未知（猜测未升级前的等级）\r\n        // ba  未知\r\n    },\r\n    rri: function(r) {\r\n        // 未知的消息事件\r\n    },\r\n    synexp: function(r) {\r\n\r\n    },\r\n    noble_num_info: function(r) {\r\n        // 未知的消息事件\r\n    },\r\n    gbroadcast: function(r) {\r\n        // 未知的消息事件\r\n    },\r\n    qausrespond: function(r) {\r\n        // 未知的消息事件\r\n    },\r\n    wiru: function(r) {\r\n        // 未知的消息事件\r\n    },\r\n    wirt: function(r) {\r\n        // 未知的消息事件\r\n    },\r\n    mcspeacsite: function(r) {\r\n        // 未知的消息事件\r\n    },\r\n    rank_change: function(r) {\r\n        // 未知的消息事件\r\n    },\r\n    srres: function(r) {\r\n        // 未知的消息事件\r\n    },\r\n    anbc: function(r) {\r\n        // 未知的消息事件\r\n    },\r\n    frank: function(r) {\r\n        // 粉丝排行榜变化\r\n    },\r\n}","require('fast-text-encoding')\r\nconst util = require('./util')\r\n\r\nclass Packet {\r\n    constructor() {\r\n        this.HEADER_LEN_SIZE = 4\r\n        this.HEADER_LEN_TYPECODE = 2\r\n        this.HEADER_LEN_ENCRYPT = 1\r\n        this.HEADER_LEN_PLACEHOLDER = 1\r\n        this.HEADER_LEN_TOTAL = this.HEADER_LEN_SIZE * 2 +\r\n            this.HEADER_LEN_TYPECODE +\r\n            this.HEADER_LEN_ENCRYPT +\r\n            this.HEADER_LEN_PLACEHOLDER\r\n\r\n        this.encoder = new TextEncoder()\r\n        this.decoder = new TextDecoder()\r\n        this.buffer = new ArrayBuffer(0)\r\n        this.readLength = 0\r\n    }\r\n\r\n    concat() {\r\n        const arr = []\r\n        for (let n = 0; n < arguments.length; n++) arr[n] = arguments[n]\r\n\r\n        return arr.reduce(function (arr, buf) {\r\n            const message = buf instanceof ArrayBuffer ? new Uint8Array(buf) : buf\r\n            const t = new Uint8Array(arr.length + message.length)\r\n            t.set(arr, 0)\r\n            t.set(message, arr.length)\r\n            return t\r\n        }, new Uint8Array(0))\r\n    }\r\n\r\n    Encode(data) {\r\n        const msgBody = this.concat(this.encoder.encode(data), Uint8Array.of(0))\r\n        const msgLen = msgBody.length + this.HEADER_LEN_SIZE * 2\r\n        const msgTotalLen = msgBody.length + this.HEADER_LEN_TOTAL\r\n        const r = new DataView(new ArrayBuffer(msgTotalLen))\r\n\r\n        r.setUint32(0, msgLen, true)\r\n        r.setUint32(4, msgLen, true)\r\n        r.setInt16(8, 689, true)\r\n        r.setInt16(10, 0, true)\r\n\r\n        return new Uint8Array(r.buffer).set(msgBody, this.HEADER_LEN_TOTAL), r.buffer\r\n    }\r\n\r\n    Decode(buf, callback) {\r\n        this.buffer = this.concat(this.buffer, buf).buffer\r\n        while (this.buffer && this.buffer.byteLength > 0) {\r\n            if (0 === this.readLength) {\r\n                if (this.buffer.byteLength < 4) return;\r\n\r\n                this.readLength = new DataView(this.buffer).getUint32(0, true)\r\n                this.buffer = this.buffer.slice(4)\r\n            }\r\n\r\n            if (this.buffer.byteLength < this.readLength) return;\r\n\r\n            const message = this.decoder.decode(this.buffer.slice(8, this.readLength - 1))\r\n            this.buffer = this.buffer.slice(this.readLength)\r\n            this.readLength = 0\r\n            callback(message)\r\n        }\r\n    }\r\n\r\n    /**\r\n     * blob转arraybuffer\r\n     * @param {Blob} blob 待转换的Blob类型参数\r\n     */\r\n    Blob2ab(blob) {\r\n        return new Promise((resolve, reject) => {\r\n            const reader = new FileReader()\r\n            reader.onload = function (e) {\r\n                resolve(e.target.result)\r\n            }\r\n            reader.readAsArrayBuffer(blob)\r\n        })\r\n    }\r\n\r\n    /**\r\n     * arraybuffer转blob\r\n     * @param {ArrayBuffer} ab 待转换的ArrayBuffer类型参数\r\n     */\r\n    Ab2blob(ab) {\r\n        return new Blob([ab])\r\n    }\r\n}\r\n\r\nmodule.exports = new Packet()","const util = require('./util')\r\n\r\nclass STT {\r\n    escape(v) {\r\n        return util.isUndefined(v) ? '' : v.toString().replace(/@/g, '@A').replace(/\\//g, '@S')\r\n    }\r\n\r\n    unescape(v) {\r\n        return util.isUndefined(v) ? '' : v.toString().replace(/@A/g, '@').replace(/@S/g, '/')\r\n    }\r\n\r\n    serialize(raw) {\r\n        if (util.isObject(raw)) {\r\n            return Object.keys(raw).map(k => `${k}@=${this.escape(this.serialize(raw[k]))}/`).join('')\r\n        } else if (Array.isArray(raw)) {\r\n            return raw.map(v => `${this.escape(this.serialize(v))}/`).join('')\r\n        } else if (util.isString(raw) || util.isNumber(raw)) {\r\n            return raw.toString()\r\n        }\r\n    }\r\n\r\n    deserialize(raw) {\r\n        if (raw.includes('//')) {\r\n            return raw.split('//').filter(e => e !== '').map(item => this.deserialize(item))\r\n        }\r\n\r\n        if (raw.includes('@=')) {\r\n            return raw.split('/').filter(e => e !== '').reduce((o, s) => {\r\n                const [k, v] = s.split('@=')\r\n                o[k] = this.deserialize(this.unescape(v))\r\n                return o\r\n            }, {})\r\n        } else if (raw.includes('@A=')) {\r\n            return this.deserialize(this.unescape(raw))\r\n        } else {\r\n            return raw.toString()\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = new STT()","function Util() {\r\n    [\r\n        'Object',\r\n        'Array',\r\n        'String',\r\n        'Number',\r\n        'Boolean',\r\n        'Function',\r\n        'RegExp',\r\n        'Date',\r\n        'Undefined',\r\n        'Null',\r\n        'Symbol',\r\n        'Blob',\r\n        'ArrayBuffer'\r\n    ].forEach(type => {\r\n        this[`is${type}`] = (p) => Object.prototype.toString.call(p).slice(8, -1) === type\r\n    })\r\n}\r\n\r\n//判断浏览器环境\r\nUtil.prototype.isBrowser = () => (typeof window !== 'undefined') ? true : false\r\n\r\n//随机数生成\r\nUtil.prototype.random = (min, max) => Math.floor(Math.random() * (max - min + 1) + min)\r\n\r\n//web端下载文件\r\nUtil.prototype.download = function(filename, text) {\r\n    if (this.isBrowser()) {\r\n        let element = document.createElement('a');\r\n        element.style.display = 'none'\r\n        let blob = new Blob([text])\r\n        element.download = `${filename}.log`\r\n        element.href = URL.createObjectURL(blob)\r\n        document.body.appendChild(element)\r\n        element.click()\r\n        URL.revokeObjectURL(blob)\r\n        document.body.removeChild(element)\r\n    }\r\n}\r\n\r\nmodule.exports = new Util()","const util = require('./util')\r\n\r\nclass websocket {\r\n    constructor(address) {\r\n        this.listener = {}\r\n        this.socket = new WebSocket(address)\r\n    }\r\n\r\n    send(data) {\r\n        this.socket.send(data)\r\n    }\r\n\r\n    close(code, reason) {\r\n        this.socket.close(code, reason)\r\n    }\r\n\r\n    on(method, callback) {\r\n        let eventName = ['open', 'error', 'close', 'message'].find(event => event === method.toLocaleLowerCase())\r\n\r\n        if (eventName) {\r\n            if (Object.keys(this.listener).includes(eventName)) {\r\n                this.socket.removeEventListener(eventName, this.listener[eventName])\r\n            }\r\n\r\n            this.listener[eventName] = callback\r\n            this.socket.addEventListener(eventName, callback)\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = util.isBrowser() ? websocket : require('ws')","'use strict'\r\nimport douyudanmaku from '../src/index'\r\n\r\nwindow.douyudanmaku = douyudanmaku\r\nwindow.danmaku = douyudanmaku\r\n","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n"],"sourceRoot":""}